<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <link rel = "stylesheet" href = /css/template.css>
    <link rel = "stylesheet" href = /css/timesheetDashboard.css>
    <title>Time Sheet Dashboard</title>
</head>
<body>

<main class="container mt-4" role="main">
    <div class="template"></div>
</main>

    <div>
        <table id="timeSheetTable">
            <tr>
                <th>Manager</th>
                <th>Contractor</th>
                <th>Status</th>
            </tr>
        </table>
    </div>

    <script>

        var tempTimeSheetArray = "[[${pendingTimeSheets}]]";

        var timeSheetArray = tempTimeSheetArray.split(",");     //split the string of time sheets into an array of timesheets

        var timeSheetArray2 = timeSheetArray.toString().split(")"); //split the string of time sheets into an array of timesheets

        var table = document.getElementById("timeSheetTable");

        var count = 1;                              //using a counter to add 2 rows per entry in the time sheet array so the extra row can be used to show more data when dropped down

        var count2 = 0;                             //using this to always get the first entry into the timesheet from the time sheet array which will always be 0, then a multiple of 9

        var openRow;

        for(var i=1;i<timeSheetArray2.length;i++){
            var data = timeSheetArray2.toString().split(",").toString().split(",");
            console.log("timesheet" + timeSheetArray2);
            console.log("data" + data);
            var toInsert = data.slice(count2,count2+9);         //split the array of timesheets into its own array (array of arrays)
            console.log("toInsert"+toInsert);

            var firstEntry = toInsert[0].substring((toInsert[0].indexOf("("))+1); //remove the [TimeSheet from the front of the data

            var row = table.insertRow(count);//add a a new row to the table
            row.id = "row" + count;
            row.insertCell(0);
            row.insertCell(1);  //insert the columns into said row
            row.insertCell(2);
            table.rows[count].cells[0].innerHTML = firstEntry;      //this will need to be changed to get the manager id out of the database
            table.rows[count].cells[1].innerHTML = toInsert[1];         //add the data to each of the respective columns
            table.rows[count].cells[2].innerHTML = toInsert[8];  //add the data and remove the two ,'s at the end

            count2 += 10;        //increase the counter to put the correct data into the correct cells

            var spareRow = table.insertRow(count+1);        //add another row to the table to be used later
            spareRow.id = "dropDownRow"+count;


            // spareRow.insertCell(0);         //add some empty cells so we can add data to the end cell (stop the table stretching)********************
            // spareRow.insertCell(1);         //could maybe remove this if we can fix it with css? *******************


            var dropDownCell = spareRow.insertCell(0);       //add a cell to the row and give both the row and the cell an ID
            dropDownCell.id = "dropDownCell" + count;

            count+=2;   //incrementing the counter by 2 as 2 rows have been added to the table

            document.getElementById(row.id).onclick = function(){           //add an on click function

                dropDownTable = document.createElement('table');    //the function creates a new table
                dropDownTable.id = "dropDownTable";

                ddHeader = dropDownTable.createTHead();         //add a header

                ddRow = ddHeader.insertRow(0);             //adds a row to the header
                ddRow.insertCell(0);
                ddRow.insertCell(1);            //add cells to the new row
                ddRow.insertCell(2);
                ddRow.insertCell(3);
                ddRow.insertCell(4);
                ddRow.insertCell(5);
                ddRow.insertCell(6);

                dropDownTable.rows[0].cells[0].innerHTML = "Number Of Days Worked";
                dropDownTable.rows[0].cells[1].innerHTML = "Overtime Worked";   //adds headings into these cells
                dropDownTable.rows[0].cells[2].innerHTML = "Start Date";
                dropDownTable.rows[0].cells[3].innerHTML = "End Date";
                dropDownTable.rows[0].cells[4].innerHTML = "Date Submitted";
                dropDownTable.rows[0].cells[5].innerHTML = "Notes";
                dropDownTable.rows[0].cells[6].innerHTML = "Status";

                ddRow2 = dropDownTable.insertRow(1);           //adds another row to the table
                ddRow2.insertCell(0);
                ddRow2.insertCell(1);            //add cells to the new row
                ddRow2.insertCell(2);
                ddRow2.insertCell(3);
                ddRow2.insertCell(4);
                ddRow2.insertCell(5);
                ddRow2.insertCell(6);

                var clickPosition = this.id;
                var id = clickPosition.substring(3); //create the id for data addition and appending the table
                var arrayPosition = Math.floor(id/2)*10;

                var select = document.createElement("select");
                select.setAttribute("id","select"+id);

                var option;

                option = document.createElement("option");
                option.setAttribute("value", "Pending");
                option.innerHTML = "Pending";
                select.appendChild(option);

                option = document.createElement("option");
                option.setAttribute("value", "Rejected");
                option.innerHTML = "Rejected";
                select.appendChild(option);

                option = document.createElement("option");
                option.setAttribute("value", "Approved");
                option.innerHTML = "Approved";
                select.appendChild(option);

                dropDownTable.rows[1].cells[0].innerHTML = data[arrayPosition+2].substring(data[arrayPosition+2].indexOf("=")+1,data[arrayPosition+2].length);
                dropDownTable.rows[1].cells[1].innerHTML = data[arrayPosition+3].substring(data[arrayPosition+3].indexOf("=")+1,data[arrayPosition+3].length);   //adds data into the cells
                dropDownTable.rows[1].cells[2].innerHTML = data[arrayPosition+4].substring(data[arrayPosition+4].indexOf("=")+1,data[arrayPosition+4].length);   //and remove specific characters at the start and end of the string
                dropDownTable.rows[1].cells[3].innerHTML = data[arrayPosition+5].substring(data[arrayPosition+5].indexOf("=")+1,data[arrayPosition+5].length);
                dropDownTable.rows[1].cells[4].innerHTML = data[arrayPosition+6].substring(data[arrayPosition+6].indexOf("=")+1,data[arrayPosition+6].length);
                dropDownTable.rows[1].cells[5].innerHTML = data[arrayPosition+7].substring(data[arrayPosition+7].indexOf("=")+1,data[arrayPosition+7].length);
                dropDownTable.rows[1].cells[6].appendChild(select);
                // data[arrayPosition+8].substring(data[arrayPosition+8].indexOf("=")+1,data[arrayPosition+8].length-2);  //remove an extra , on the pending column



                if (document.getElementById("dropDownTable") != null){
                    document.getElementById(openRow).removeChild(document.getElementById("dropDownTable"));
                }

                openRow = "dropDownCell"+id;

                document.getElementById("dropDownCell" + id).appendChild(dropDownTable);    //appends the new table into the cell we created earlier NEEDS TO CHANGE DEPENDING ON WHAT CELL IS CLICKED

            }
        }




    </script>

</body>
</html>